<div class="container">



  <div id="wonderPhotosCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      <% if @wonder.photos.attached? %>
        <% @wonder.photos.each_with_index do |photo, index| %>
          <div class="carousel-item <%= 'active' if index.zero? %>">
            <%= cl_image_tag(photo.key, class: "d-block w-100", alt: "Wonder photo #{index}") %>
          </div>
        <% end %>
      <% else %>
        <div class="carousel-item active">
          <%= image_tag('thumbnail.jpeg', class: "d-block w-100", alt: "Default thumbnail") %>
        </div>
      <% end %>
    </div>
    <a class="carousel-control-prev" href="#wonderPhotosCarousel" role="button" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#wonderPhotosCarousel" role="button" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>

  <div class="principal-infos d-flex align-items-center justify-content-between pt-2">
    <h1><%= @wonder.title %></h1>
    <div class="buttons-container d-flex justify-content-end">
      <p type="button" class="button" data-bs-toggle="modal" data-bs-target="#shareModal">Share</p>
      <p class="button">Save</p>
    </div>
  </div>
  <%= render "shared/share" %>

  <div class="row">
    <div class="col-md-8 col-sm-12">
      <div class="infos-container ml-8">
        <div class="user d-flex align-items-center justify-content-between py-3">
        <div class="d-flex">
          <div class="avatar-pic">
            <% if @wonder.user.avatar.attached? %>
              <%= cl_image_tag @wonder.user.avatar.key, crop: :fill, class: "avatar-show", alt: "dropdown menu" %>
            <% else %>
              <%= image_tag "avatar.jpeg", class: "avatar-show", alt: "dropdown menu" %>
            <% end %>          </div>
          <div class="user-details">
            <p class="user-name mb-1 pl-1">Proposed by: <strong><%= @wonder.user.username %></strong></p>
            <p class="button text-secondary mb-1">Send a message</p>
        </div>
        </div>
        <div class="d-block">
            <div class="description d-flex align-items-center">
              <i class="fa-solid fa-location-dot fa-xl"></i>
              <div class="flex-grow-1">
                <h4 class="ms-2 mb-0"><%= @wonder.location %></h4>
              </div>
            </div>
            <div class="description d-flex align-items-center">
              <i class="fa-solid fa-tag fa-xl"></i>
              <div class="flex-grow-1">
                <h4 class="ms-2 mb-0"><%= @wonder.category %></h4>
              </div>
            </div>
        </div>
        </div>

        <hr>

        <div class="description py-4 align-items-center">
          <h3 class="mb-2"><%= @wonder.content %></h3>
          <div class="flex-grow-1">
            <%= @wonder.long_description %>
          </div>
        </div>
        <hr>

        <div class="d-grid">
          <p class="button mt-3 col-3"><%= link_to "Back to all wonders", wonders_path %></p>
        </div>
      </div>
    </div>

    <div class="col-md-4 col-sm-12">
      <div class="booking-container p-4">
        <div class="card p-3 shadow p-3 mb-5 bg-body-tertiary rounded">
          <div class="card-body">
            <div class="price d-flex align-items-center pb-3">
              <i class="fa-solid fa-tag details-icon"></i>
              <h5 class="mb-0"><strong><%= @wonder.price_per_participant.to_i %> €</strong> per participant</h5>
              </div>

            <%= simple_form_for [@wonder, @reservation], data: {controller: "datepicker"} do |f| %>
              <%= f.input :book_date,
                          as: :string,
                          label: 'Number of participant',
                          input_html: {
                            { data: { datepicker_target: "book_date" } },
                            label: false,
                            placeholder: 'Date'
                          }
              <%= f.input :nb_participants,
                          as: :integer,
                          label: 'Number of participant',
                          input_html: {
                            id: 'nb_participants_field',
                            min: 1,
                            max: 10
                          } %>
              <div class="d-grid">
                <%= f.button :submit, '✨ Book this wonder ✨', class: "btn btn-primary col-12 mt-3" %>
              </div>
            <% end %>
            <hr>

            <div class="summary">
              <div class="d-flex justify-content-between">
                <div class="w-100 fw-medium"><p>Total</p></div>
                <div class="flex-shrink-1 fw-medium"><p id="totalPrice"><%= @wonder.price_per_participant.to_int %>€</p></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
setTimeout(function() {
  const nbParticipantsInput = document.getElementById('nb_participants');
  const totalPriceElement = document.getElementById('totalPrice');
  const pricePerParticipant = <%= @wonder.price_per_participant %>;

  function updateTotal() {
    const nbParticipants = nbParticipantsInput.value || 0;
    const total = nbParticipants * pricePerParticipant;
    totalPriceElement.textContent = `${total}€`;
  }

  if (nbParticipantsInput) {
    nbParticipantsInput.addEventListener('input', updateTotal);
  }
}, 1000); // Retarde l'exécution de la fonction de 2 secondes
</script>
